name: Generate LeetCode File

on:
  workflow_dispatch:
    inputs:
      filename:
        description: 'Filename for the new LeetCode problem (e.g., 001-Two-Sum)'
        required: true
        type: string
      language:
        description: 'Programming language (default: java)'
        required: false
        default: 'java'
        type: string

jobs:
  generate:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¦ Checkout the repository
        uses: actions/checkout@v3

      - name: âš™ï¸ Set up Git config
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"

      - name: ğŸ§  Generate file based on language
        run: |
          FILENAME="${{ github.event.inputs.filename }}"
          LANG="${{ github.event.inputs.language }}"
          DIR="solutions"
          mkdir -p "$DIR"

          # Sanitize and format filename
          SAFE_FILENAME=$(echo "$FILENAME" | xargs | tr ' ' '_' | tr -cd '[:alnum:]_-')
          EXT=""
          FILEPATH="${DIR}/${SAFE_FILENAME}"

          if [ "$LANG" = "java" ]; then
            EXT="java"
            FILEPATH="${FILEPATH}.${EXT}"
            echo "// Problem: $FILENAME" > "$FILEPATH"
            echo "public class Solution {" >> "$FILEPATH"
            echo "    public static void main(String[] args) {" >> "$FILEPATH"
            echo "        // Your code goes here" >> "$FILEPATH"
            echo "    }" >> "$FILEPATH"
            echo "}" >> "$FILEPATH"

          elif [ "$LANG" = "py" ]; then
            EXT="py"
            FILEPATH="${FILEPATH}.${EXT}"
            echo "# Problem: $FILENAME" > "$FILEPATH"
            echo "def solution():" >> "$FILEPATH"
            echo "    pass" >> "$FILEPATH"

          elif [ "$LANG" = "cpp" ]; then
            EXT="cpp"
            FILEPATH="${FILEPATH}.${EXT}"
            echo "// Problem: $FILENAME" > "$FILEPATH"
            echo "#include <iostream>" >> "$FILEPATH"
            echo "int main() {" >> "$FILEPATH"
            echo "    // Your code here" >> "$FILEPATH"
            echo "    return 0;" >> "$FILEPATH"
            echo "}" >> "$FILEPATH"

          else
            echo "âŒ Unsupported language: $LANG"
            exit 1
          fi

      - name: âœ… Commit & push the file
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git fetch origin main
          git rebase origin/main

          git add solutions/
          git commit -m "ğŸ“˜ Add LeetCode solution: ${{ github.event.inputs.filename }} in ${{ github.event.inputs.language }}" || echo "ğŸŸ¡ Nothing to commit"
          git push origin HEAD || echo "âš ï¸ Push failed"
